#!/usr/bin/env bash
set -euo pipefail

if [[ $# -eq 0 ]]; then
  tmux new-session -A -s claude "claude"
  exit 0
fi

name=$1
session=${name//\//-}

# Create worktree if we're in a git repo
if git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
  repo_root=$(git rev-parse --show-toplevel)
  repo_name=$(basename "$repo_root")
  wt_path="$(dirname "$repo_root")/${repo_name}-${session}"

  if [[ ! -d "$wt_path" ]]; then
    wt -b main "$name"
  fi

  tmux new-session -A -s "$session" -c "$wt_path" "claude"
else
  tmux new-session -A -s "$session" "claude"
fi
